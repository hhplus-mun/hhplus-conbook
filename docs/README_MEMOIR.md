# Chapter 2 - 서버 구축 회고 (콘서트 예약 서비스)

## 1. 프로젝트 개요
- 목적: 동시성을 고려한 안정적인 콘서트 예약 시스템 구축
- 개발 기간: 2024.10.05 ~ 2024.10.25 
- 기술 스택
  - Spring Boot, Spring Security, Spring Data JPA
  - MariaDB, H2
  - JWT
- 주요 기능: 콘서트 조회, 예약, 결제

<br>

## 2. 주요 도전 과제와 해결방법
### 2-1. 대기열 구현 방식
 대기열 구현 방법으로 크게 1)한명씩 순차적으로 통과시키는 방법과 2)일정 시간을 기준으로 반복하여 <br>
 정해진 인원을 통과시키는 방법이 있으며, 여기서는 2)번 방법을 기준으로 대기열을 구현한다.
- 문제: 콘서트 별 개별 대기열을 구성할 때 각 공연별 허용 인원 설정
- 해결: 콘서트 균등 분배로 해결 <br>
  예) 콘서트이 3개 있고 서버에서 총 처리할 수 있는 사용자 수가 120명이라면 콘서트은 각각 40명의 <br>
  접근 권한(Access Token)을 제공할 수 있다.

### 2-2. 동시성
- Spring Data JPA 에서 제공하는 @Lock 어노테이션 활용
- 콘서트 좌석 예매 시 발생하는 동시성 이슈는 데이터의 업데이트와 관련되어 있기 때문에 비관적 락 모드 적용

<br>

## 배운 점들
- 프로젝트 설계와 요구사항 분석 <br>
  개발부터 시작하고 보는 과거와 달리 설계를 기반으로 순차적으로 개발을 진행해 볼 수 있었다. <br>
  요구사항을 분석하고 시퀀스 다이어그램을 그리는 경험은 구성할 도메인을 이해하는데 도움을 준다. <br>
  무엇을 어떻게 개발할지 방향성 지정의 중요성을 확인할 수 있다. 
- 패키지 설계 기준 <br>
  레이어드 아키텍처를 바탕으로 패키지를 구성할 때 무엇을 중요하게 생각해야하는지 핵심을 확인해 볼 수 있었다.
- 외래키와 그 파급효과 <br>
  DB에서 외래키를 설정하지 않으면 데이터 무결성이 깨질 확률이 있기 때문에 외래키를 설정해야 한다고 생각했으나, <br>
  데드락 발생과 예상치 못한 결과 도출 가능성과 같은 성능 측면을 봤을 때 외래키 설정을 위해서는 <br>
  여러 항목을 확인해야함을 알 수 있다.

<br>

## 아쉬운 점
- 다채로운 통합테스트 부족 <br>
  시간 부족으로 인하여 요구사항을 충족시키기 위해 필요한 핵심적인 기능에 대해서 작은 단위의 통합테스트만 진행되었다. <br>
  때문에, 여러 복합적인 시나리오 케이스에 대한 테스트가 진행되지 않았다.
- 상세 기능 측면에서의 낮은 완성도 <br>
  명세된 요구사항 충족이 최우선이었기 때문에 디테일한 부분에서는 다소 낮은 완성도를 보인다.
- 일부 기능들에 대한 낮은 이해도
  단순 사용법만 확인하고 도입했기 때문에 그 원리를 제대로 파악하지 못한 케이스가 존재한다.   

<br>

## 향후 계획
- FAT 서비스 리팩토링
- 콘서트별 대기열 허용인원 설정 전략 수립
- 테스트 컨테이너 적용

